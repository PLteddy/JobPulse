{% extends 'base.html.twig' %}
{% block title %}Mes offres{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/reset.css') }}">
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
    <link rel="stylesheet" href="{{ asset('css/home.css') }}">
    <link rel="stylesheet" href="{{ asset('css/offres.css') }}">

{% endblock %}

{% block body %}

<section class="container mt-4">
    <div class="titre-creation-offres">
        <h1>Mes offres</h1>

        <button onclick="window.location.href='{{ path('app_poste_new') }}'" class="bouton-ajouter">
            Ajouter
            <img src="{{ asset('img/Plus.png') }}" alt="icone ajouter">
        </button>
    </div>
    {% if postes|length > 0 %}
        <div class="results-container">
            <div class="results-grid">
                {% for poste in postes %}
                    <div class="card-wrapper">
                        <div class="actions-container">
                            <button onclick="window.location.href='{{ path('app_poste_edit', {'id': poste.id}) }}'" class="bouton-ajouter">
                                Modifier
                                <img src="{{ asset('img/modifier-icone.png') }}" alt="icone modifié">
                            </button>
                            <form method="post" action="{{ path('app_poste_delete', {'id': poste.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette offre?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ poste.id) }}">
                                <button class="bouton-supprimer">Supprimer
                                <img src="{{ asset('img/Croix.png') }}" alt="icone modifié">
                                </button>
                            </form>
                        </div>
                        <div class="job-card card">
                            <div class="image-container">
                                {% if poste.image %}
                                    <img src="{{ asset('uploads/images/' ~ poste.image) }}" alt="{{ poste.intitule }}">
                                {% else %}
                                    <span class="text-muted">Aucune image</span>
                                {% endif %}
                            </div>
                            <div class="card-body">
                                <div class="debut-carte">
                                    <h4 class="card-title">{{ poste.intitule }}</h4>
                                </div>
                                <div class="localisation">
                                    <img src="{{ asset('img/localisation.svg') }}" alt="point de repère" class="mini-icon">
                                    <p>{{ poste.localisation }}</p>
                                </div>
                                <p class="domaine-text">{{ poste.domaine }}</p>
                            </div>
                        </div>

                        <!-- Section des candidatures -->
                        <div class="candidatures-section">
                            {% if poste.candidatures|length > 0 %}
                                <h5>Candidatures reçues :</h5>
                                <ul>
                                    {% for candidature in poste.candidatures %}
                                        
                                            <a href="{{ path('etudiant_profil_utilisateur', { id: candidature.utilisateur.id }) }}" class="profil-link">
                                                {% if candidature.utilisateur.photoProfil %}
                                                    <img 
                                                        src="{{ asset('uploads/images/' ~ candidature.utilisateur.photoProfil) }}" 
                                                        alt="Photo de {{ candidature.utilisateur.nom }}" 
                                                        class="profil-photo"
                                                    >
                                                {% else %}
                                                    <img 
                                                        src="{{ asset('img/profil.png') }}" 
                                                        alt="Photo par défaut" 
                                                        class="profil-photo"
                                                    >
                                                {% endif %}
                                                {{ candidature.utilisateur.nom }} {{ candidature.utilisateur.prenom }}
                                            </a>
                                            
                                            <a href="{{ path('app_messagemessagerie', { id: candidature.utilisateur.id }) }}" class="btn btn-primary">Envoyer un message</a>
                                            <a href="{{ asset('uploads/cv/' ~ candidature.cvCandidature) }}" class="btn btn-secondary" download>Télécharger le CV</a>
                                            <form method="post" action="{{ path('candidature_accepter', { id: candidature.id }) }}">
                                                <button type="submit" class="btn btn-success">Accepter</button>
                                            </form>
                                            <form method="post" action="{{ path('candidature_refuser', { id: candidature.id }) }}">
                                                <button type="submit" class="btn btn-danger">Refuser</button>
                                            </form>
                                        
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p>Cette offre n'a pas encore de réponse.</p>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <p>Aucune offre disponible.</p>
    {% endif %}
</section>
{% endblock %}